{"version":3,"file":"index.ts-63ecff68.js","sources":["../../src/background/source.ts","../../src/background/index.ts"],"sourcesContent":["import { ofetch } from 'ofetch'\n\nconst plausibleApiHost = import.meta.env.VITE_PLAUSIBLE_API_HOST || 'https://plausible.io'\n\nasync function trackEvent(name: string, props: object) {\n  await ofetch(`${plausibleApiHost}/api/event`, {\n    method: 'POST',\n    body: {\n      domain: 'chathub.gg',\n      name,\n      url: location.href,\n      props,\n    },\n    mode: 'no-cors',\n  })\n}\n\nexport async function trackInstallSource() {\n  const { source } = await ofetch('https://chathub.gg/api/user/source', {\n    credentials: 'include',\n  })\n  trackEvent('install', { source })\n}\n","import Browser from 'webextension-polyfill'\nimport { ALL_IN_ONE_PAGE_ID } from '~app/consts'\nimport { getUserConfig } from '~services/user-config'\nimport { trackInstallSource } from './source'\n\nasync function openAppPage() {\n  const tabs = await Browser.tabs.query({})\n  const url = Browser.runtime.getURL('app.html')\n  const tab = tabs.find((tab) => tab.url?.startsWith(url))\n  if (tab) {\n    await Browser.tabs.update(tab.id, { active: true })\n    return\n  }\n  const { startupPage } = await getUserConfig()\n  const hash = startupPage === ALL_IN_ONE_PAGE_ID ? '' : `#/chat/${startupPage}`\n  await Browser.tabs.create({ url: `app.html${hash}` })\n}\n\nBrowser.action.onClicked.addListener(() => {\n  openAppPage()\n})\n\nBrowser.runtime.onInstalled.addListener((details) => {\n  if (details.reason === 'install') {\n    openAppPage()\n    trackInstallSource()\n  }\n})\n\nBrowser.commands.onCommand.addListener(async (command) => {\n  console.debug(`Command: ${command}`)\n  if (command === 'open-app') {\n    openAppPage()\n  }\n})\n"],"names":["plausibleApiHost","trackEvent","name","props","ofetch","trackInstallSource","source","openAppPage","tabs","Browser","url","tab","startupPage","getUserConfig","hash","ALL_IN_ONE_PAGE_ID","details","command"],"mappings":"+GAEA,MAAMA,KAAmC,yBAA2B,uBAEpE,eAAeC,EAAWC,EAAcC,EAAe,CAC/C,MAAAC,EAAO,GAAGJ,cAA8B,CAC5C,OAAQ,OACR,KAAM,CACJ,OAAQ,aACR,KAAAE,EACA,IAAK,SAAS,KACd,MAAAC,CACF,EACA,KAAM,SAAA,CACP,CACH,CAEA,eAAsBE,GAAqB,CACzC,KAAM,CAAE,OAAAC,CAAA,EAAW,MAAMF,EAAO,qCAAsC,CACpE,YAAa,SAAA,CACd,EACUH,EAAA,UAAW,CAAE,OAAAK,CAAA,CAAQ,CAClC,CCjBA,eAAeC,GAAc,CAC3B,MAAMC,EAAO,MAAMC,EAAQ,KAAK,MAAM,CAAE,CAAA,EAClCC,EAAMD,EAAQ,QAAQ,OAAO,UAAU,EACvCE,EAAMH,EAAK,KAAMG,UAAQA,OAAAA,EAAAA,EAAI,MAAJA,YAAAA,EAAS,WAAWD,GAAI,EACvD,GAAIC,EAAK,CACD,MAAAF,EAAQ,KAAK,OAAOE,EAAI,GAAI,CAAE,OAAQ,GAAM,EAClD,OAEF,KAAM,CAAE,YAAAC,CAAA,EAAgB,MAAMC,IACxBC,EAAOF,IAAgBG,EAAqB,GAAK,UAAUH,IACjE,MAAMH,EAAQ,KAAK,OAAO,CAAE,IAAK,WAAWK,IAAQ,CACtD,CAEAL,EAAQ,OAAO,UAAU,YAAY,IAAM,CAC7BF,GACd,CAAC,EAEDE,EAAQ,QAAQ,YAAY,YAAaO,GAAY,CAC/CA,EAAQ,SAAW,YACTT,IACOF,IAEvB,CAAC,EAEDI,EAAQ,SAAS,UAAU,YAAY,MAAOQ,GAAY,CAChD,QAAA,MAAM,YAAYA,GAAS,EAC/BA,IAAY,YACFV,GAEhB,CAAC"}